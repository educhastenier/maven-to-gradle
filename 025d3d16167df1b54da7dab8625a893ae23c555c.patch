From 691e33efa545253c4e93c413200f913e463cbaae Mon Sep 17 00:00:00 2001
From: Emmanuel Duchastenier <emmanuel.duchastenier@bonitasoft.com>
Date: Fri, 13 Jul 2018 14:32:44 +0200
Subject: [PATCH] Restore SP licences / integration + slow tests (still 2
 AccessControl tests failing)

---
 .../build.gradle                              |  6 ++++-
 community/bonita-test-api/build.gradle        |  8 ++++++
 .../build.gradle                              | 25 +++++++++++++++++++
 subscription/bonita-test-api-sp/build.gradle  |  8 ++++++
 4 files changed, 46 insertions(+), 1 deletion(-)

diff --git a/community/bonita-integration-tests/bonita-integration-tests-local/build.gradle b/community/bonita-integration-tests/bonita-integration-tests-local/build.gradle
index 83c2fc3a3f..6831c13fff 100644
--- a/community/bonita-integration-tests/bonita-integration-tests-local/build.gradle
+++ b/community/bonita-integration-tests/bonita-integration-tests-local/build.gradle
@@ -27,6 +27,10 @@ test {
     include ''
 }
 
-task integrationTest(type: Test){
+task integrationTest(type: Test) {
     include 'org/bonitasoft/engine/LocalIntegrationTests.class'
 }
+
+task slowTest(type: Test) {
+    include 'org/bonitasoft/engine/SlowExecutionLocalIntegrationTests.class'
+}
diff --git a/community/bonita-test-api/build.gradle b/community/bonita-test-api/build.gradle
index f3e9d9bab8..5c66d8682a 100644
--- a/community/bonita-test-api/build.gradle
+++ b/community/bonita-test-api/build.gradle
@@ -22,3 +22,11 @@ dependencies {
     testCompile 'ch.qos.logback:logback-classic:1.2.3'
     testCompile 'org.assertj:assertj-core:3.7.0'
 }
+
+test {
+    include '**/*Test.class'
+}
+
+task integrationTest(type: Test) {
+    include '**/*IT.class'
+}
\ No newline at end of file
diff --git a/subscription/bonita-integration-tests-sp/bonita-integration-tests-local/build.gradle b/subscription/bonita-integration-tests-sp/bonita-integration-tests-local/build.gradle
index 952cd87c3a..9f60ce35a8 100644
--- a/subscription/bonita-integration-tests-sp/bonita-integration-tests-local/build.gradle
+++ b/subscription/bonita-integration-tests-sp/bonita-integration-tests-local/build.gradle
@@ -2,6 +2,9 @@
  * This file was generated by the Gradle 'init' task.
  */
 
+configurations {
+    lic
+}
 dependencies {
     compile project(':subscription:bonita-test-api-sp')
     compile project(':subscription:bpm:bonita-server-sp')
@@ -12,6 +15,7 @@ dependencies {
     runtime 'org.slf4j:jcl-over-slf4j:1.7.25'
     testCompile 'org.awaitility:awaitility:2.0.0'
     testCompile project(':engine:bpm:bonita-deploy:bonita-deploy-tcp')
+    lic 'org.bonitasoft.security:test-licenses:1.12.2@zip'
 }
 
 task testsJar(type: Jar) {
@@ -21,3 +25,24 @@ task testsJar(type: Jar) {
 
 group = 'com.bonitasoft.engine.test'
 publishing.publications.maven.artifact(testsJar)
+
+task extractLicence(type: Copy) {
+    from zipTree(configurations.lic.resolvedConfiguration.resolvedArtifacts.first().file)
+    into "${project.buildDir}/lic"
+}
+
+test {
+    include ''
+}
+
+task integrationTest(type: Test) {
+    include 'com/bonitasoft/engine/LocalIntegrationTestsSP.class'
+    systemProperty 'bonita.client.home', "${project.buildDir}/lic/performance"
+}
+
+task slowTest(type: Test) {
+    include 'com/bonitasoft/engine/SlowExecutionLocalIntegrationTests.class'
+    systemProperty 'bonita.client.home', "${project.buildDir}/lic/performance"
+}
+tasks.integrationTest.dependsOn extractLicence
+tasks.slowTest.dependsOn extractLicence
diff --git a/subscription/bonita-test-api-sp/build.gradle b/subscription/bonita-test-api-sp/build.gradle
index 50730a4a00..27f61cb414 100644
--- a/subscription/bonita-test-api-sp/build.gradle
+++ b/subscription/bonita-test-api-sp/build.gradle
@@ -16,4 +16,12 @@ dependencies {
     testCompile 'com.microsoft.sqlserver:mssql-jdbc:7.0.0.jre8'
 }
 
+test {
+    include '**/EngineStarterSPIT.class'
+}
+
+task integrationTest(type: Test) {
+    include '**/TestEngineSPIT.class'
+}
+
 group = 'com.bonitasoft.engine'
-- 
2.20.1

