From 9e4bb1ab215a97a48632589f7128b19ce9e7d061 Mon Sep 17 00:00:00 2001
From: Baptiste Mesta <baptiste.mesta@bonitasoft.com>
Date: Thu, 12 Jul 2018 09:34:27 +0200
Subject: [PATCH] xsd generation

---
 .../bonita-api/bonita-common-api/build.gradle | 22 ++++++++++++
 .../bpm/bar/form/model/package-info.java      | 23 ++++++++++++
 .../bonitasoft/engine/form/package-info.java  | 23 ++++++++++++
 .../bonita-process-engine/build.gradle        | 21 +++++++++++
 .../bonita-process-instance/build.gradle      | 20 +++++++++++
 .../bonita-common-util/build.gradle           | 35 +++++++++++++++++++
 .../engine/bdm/model/field/RelationField.java |  2 ++
 7 files changed, 146 insertions(+)
 create mode 100644 community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java
 create mode 100644 community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/form/package-info.java

diff --git a/community/bpm/bonita-api/bonita-common-api/build.gradle b/community/bpm/bonita-api/bonita-common-api/build.gradle
index 2dda231c2a..4f9a15e22c 100644
--- a/community/bpm/bonita-api/bonita-common-api/build.gradle
+++ b/community/bpm/bonita-api/bonita-common-api/build.gradle
@@ -1,3 +1,6 @@
+plugins {
+    id 'com.intershop.gradle.jaxb' version '2.0.0'
+}
 group = 'org.bonitasoft.engine.api'
 description = 'Bonita Common APIs'
 dependencies {
@@ -13,3 +16,22 @@ task packageTests(type: Jar) {
   classifier = 'tests'
 }
 artifacts.archives packageTests
+
+
+jaxb {
+    //generates schema from java code
+    schemaGen {
+        forms {
+            javaFiles = fileTree(dir: 'src/main/java', includes: [
+                    'org/bonitasoft/engine/bpm/bar/form/model/*.java',
+                    'org/bonitasoft/engine/form/*.java'])
+            namespaceconfigs = ['http://www.bonitasoft.org/ns/form/6.0': 'form-mapping.xsd']
+            outputDir = project.file("build/generated/jaxb/schema/form")
+        }
+    }
+}
+processResources {
+    from "$buildDir/generated/jaxb/schema/form"
+}
+
+tasks.processResources.dependsOn tasks.jaxbSchemaGenForms
\ No newline at end of file
diff --git a/community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java b/community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java
new file mode 100644
index 0000000000..a0e1a0472f
--- /dev/null
+++ b/community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java
@@ -0,0 +1,23 @@
+/**
+ * Copyright (C) 2017 Bonitasoft S.A.
+ * Bonitasoft, 32 rue Gustave Eiffel - 38000 Grenoble
+ * This library is free software; you can redistribute it and/or modify it under the terms
+ * of the GNU Lesser General Public License as published by the Free Software Foundation
+ * version 2.1 of the License.
+ * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ * See the GNU Lesser General Public License for more details.
+ * You should have received a copy of the GNU Lesser General Public License along with this
+ * program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth
+ * Floor, Boston, MA 02110-1301, USA.
+ **/
+
+/**
+ * @author Baptiste Mesta
+ */
+@XmlSchema(namespace = "http://www.bonitasoft.org/ns/form/6.0", elementFormDefault = XmlNsForm.UNSET, xmlns = {
+        @javax.xml.bind.annotation.XmlNs(namespaceURI = "http://www.bonitasoft.org/ns/form/6.0", prefix = "form") })
+package org.bonitasoft.engine.bpm.bar.form.model;
+
+import javax.xml.bind.annotation.XmlNsForm;
+import javax.xml.bind.annotation.XmlSchema;
diff --git a/community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/form/package-info.java b/community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/form/package-info.java
new file mode 100644
index 0000000000..5d3a9dd463
--- /dev/null
+++ b/community/bpm/bonita-api/bonita-common-api/src/main/java/org/bonitasoft/engine/form/package-info.java
@@ -0,0 +1,23 @@
+/**
+ * Copyright (C) 2017 Bonitasoft S.A.
+ * Bonitasoft, 32 rue Gustave Eiffel - 38000 Grenoble
+ * This library is free software; you can redistribute it and/or modify it under the terms
+ * of the GNU Lesser General Public License as published by the Free Software Foundation
+ * version 2.1 of the License.
+ * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ * See the GNU Lesser General Public License for more details.
+ * You should have received a copy of the GNU Lesser General Public License along with this
+ * program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth
+ * Floor, Boston, MA 02110-1301, USA.
+ **/
+
+/**
+ * @author Baptiste Mesta
+ */
+@XmlSchema(namespace = "http://www.bonitasoft.org/ns/form/6.0", elementFormDefault = XmlNsForm.UNSET, xmlns = {
+        @javax.xml.bind.annotation.XmlNs(namespaceURI = "http://www.bonitasoft.org/ns/form/6.0", prefix = "form") })
+package org.bonitasoft.engine.form;
+
+import javax.xml.bind.annotation.XmlNsForm;
+import javax.xml.bind.annotation.XmlSchema;
diff --git a/community/bpm/bonita-core/bonita-process-engine/build.gradle b/community/bpm/bonita-core/bonita-process-engine/build.gradle
index 8c1a4b23df..238bf0d191 100644
--- a/community/bpm/bonita-core/bonita-process-engine/build.gradle
+++ b/community/bpm/bonita-core/bonita-process-engine/build.gradle
@@ -1,3 +1,7 @@
+plugins {
+  id 'com.intershop.gradle.jaxb' version '2.0.0'
+}
+
 group = 'org.bonitasoft.engine.core'
 description = 'Bonita Process Engine'
 dependencies {
@@ -67,3 +71,20 @@ dependencies {
     testCompile group: 'org.springframework', name: 'spring-test', version:'5.0.6.RELEASE'
   compileOnly project(':bpm:bonita-common')
 }
+
+
+jaxb {
+  schemaGen {
+    organization {
+      javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/identity/xml/**/*.java')
+      namespaceconfigs = ['http://documentation.bonitasoft.com/organization-xml-schema/1.1': 'organization.xsd']
+      outputDir = project.file("build/generated/jaxb/schemas")
+    }
+  }
+}
+
+processResources {
+  from "$buildDir/generated/jaxb/schemas"
+}
+
+tasks.processResources.dependsOn tasks.jaxbSchemaGenOrganization
\ No newline at end of file
diff --git a/community/bpm/bonita-core/bonita-process-instance/build.gradle b/community/bpm/bonita-core/bonita-process-instance/build.gradle
index b199334006..819183a5e4 100644
--- a/community/bpm/bonita-core/bonita-process-instance/build.gradle
+++ b/community/bpm/bonita-core/bonita-process-instance/build.gradle
@@ -1,3 +1,7 @@
+plugins {
+    id 'com.intershop.gradle.jaxb' version '2.0.0'
+}
+
 group = 'org.bonitasoft.engine.core.process.instance'
 description = ''
 dependencies {
@@ -27,3 +31,19 @@ dependencies {
     testCompile group: 'org.assertj', name: 'assertj-core', version:'3.7.0'
     testCompile group: 'org.mockito', name: 'mockito-core', version:'2.17.0'
 }
+jaxb {
+    //generates schema from java code
+    schemaGen {
+        //generates java code for project from project schema
+        connectors {
+            javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/core/connector/parser/*.java')
+            namespaceconfigs = ['http://www.bonitasoft.org/ns/connector/implementation/6.0': 'connectors-impl.xsd']
+        }
+    }
+}
+
+processResources {
+    from "$buildDir/generated/jaxb/schema/connectors"
+}
+
+tasks.processResources.dependsOn tasks.jaxbSchemaGenConnectors
diff --git a/community/bpm/bonita-util/bonita-common-util/build.gradle b/community/bpm/bonita-util/bonita-common-util/build.gradle
index cfad7d9f75..322cf154ed 100644
--- a/community/bpm/bonita-util/bonita-common-util/build.gradle
+++ b/community/bpm/bonita-util/bonita-common-util/build.gradle
@@ -1,3 +1,6 @@
+plugins {
+    id 'com.intershop.gradle.jaxb' version '2.0.0'
+}
 group = 'org.bonitasoft.engine.util'
 description = ''
 dependencies {
@@ -12,3 +15,35 @@ dependencies {
     testCompile group: 'org.mockito', name: 'mockito-core', version:'2.17.0'
     testCompile group: 'ch.qos.logback', name: 'logback-classic', version:'1.2.3'
 }
+
+
+
+jaxb {
+    schemaGen {
+        application {
+            javaFiles = fileTree(dir: 'src/main/java', includes: [
+                    'org/bonitasoft/engine/business/application/xml/**/*.java'])
+            namespaceconfigs = ['http://documentation.bonitasoft.com/application-xml-schema/1.0': 'application.xsd']
+            outputDir = project.file("build/generated/jaxb/schemas")
+        }
+        bom {
+            javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/bdm/model/**/*.java')
+            namespaceconfigs = ['': 'bom.xsd']
+            outputDir = project.file("build/generated/jaxb/schemas")
+        }
+        profile {
+            javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/profile/xml/**/*.java')
+            namespaceconfigs = ['http://www.bonitasoft.org/ns/profile/6.1': 'profiles.xsd']
+            outputDir = project.file("build/generated/jaxb/schemas")
+        }
+    }
+}
+
+processResources {
+    from "$buildDir/generated/jaxb/schemas"
+}
+
+//tasks.processResources.dependsOn tasks.jaxbSchemaGenProcessdefinition
+tasks.processResources.dependsOn tasks.jaxbSchemaGenApplication
+tasks.processResources.dependsOn tasks.jaxbSchemaGenBom
+tasks.processResources.dependsOn tasks.jaxbSchemaGenProfile
\ No newline at end of file
diff --git a/community/bpm/bonita-util/bonita-common-util/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java b/community/bpm/bonita-util/bonita-common-util/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java
index eabe06c538..299123b4b0 100644
--- a/community/bpm/bonita-util/bonita-common-util/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java
+++ b/community/bpm/bonita-util/bonita-common-util/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java
@@ -30,10 +30,12 @@ import org.bonitasoft.engine.bdm.model.BusinessObject;
 @XmlType
 public class RelationField extends Field {
 
+    @XmlType
     public enum Type {
         AGGREGATION, COMPOSITION;
     }
 
+    @XmlType
     public enum FetchType {
         EAGER, LAZY
     }
-- 
2.17.1

