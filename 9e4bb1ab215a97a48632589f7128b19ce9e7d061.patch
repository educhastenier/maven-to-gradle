From 1a48020c318f8279dbe5eb0b2750d202889e7fd7 Mon Sep 17 00:00:00 2001
From: Baptiste Mesta <baptiste.mesta@bonitasoft.com>
Date: Thu, 12 Jul 2018 09:34:27 +0200
Subject: [PATCH] xsd generation

---
 community/bpm/bonita-common/build.gradle      | 43 +++++++++++
 .../engine/bdm/model/field/RelationField.java |  2 +
 .../bpm/bar/form/model/package-info.java      | 23 ++++++
 .../engine/bpm/form/package-info.java         | 23 ++++++
 .../bonita-process-engine/build.gradle        | 26 +++++--
 .../bonita-process-instance/build.gradle      | 76 +++++++++++--------
 6 files changed, 157 insertions(+), 36 deletions(-)
 create mode 100644 community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java
 create mode 100644 community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/form/package-info.java

diff --git a/community/bpm/bonita-common/build.gradle b/community/bpm/bonita-common/build.gradle
index af68f33288..a0ade0ee3c 100644
--- a/community/bpm/bonita-common/build.gradle
+++ b/community/bpm/bonita-common/build.gradle
@@ -1,3 +1,6 @@
+plugins {
+    id 'com.intershop.gradle.jaxb' version '2.0.0'
+}
 /*
  * This file was generated by the Gradle 'init' task.
  */
@@ -28,3 +31,43 @@ task testsJar(type: Jar) {
 
 description = 'Bonita Common'
 publishing.publications.maven.artifact(testsJar)
+
+
+jaxb {
+    //generates schema from java code
+    schemaGen {
+        forms {
+            javaFiles = fileTree(dir: 'src/main/java', includes: [
+                    'org/bonitasoft/engine/bpm/bar/form/model/*.java',
+                    'org/bonitasoft/engine/form/*.java'])
+            namespaceconfigs = ['http://www.bonitasoft.org/ns/form/6.0': 'form-mapping.xsd']
+            outputDir = project.file("build/generated/jaxb/schema/form")
+        }
+        application {
+            javaFiles = fileTree(dir: 'src/main/java', includes: [
+                    'org/bonitasoft/engine/business/application/xml/**/*.java'])
+            namespaceconfigs = ['http://documentation.bonitasoft.com/application-xml-schema/1.0': 'application.xsd']
+            outputDir = project.file("build/generated/jaxb/schemas")
+        }
+        bom {
+            javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/bdm/model/**/*.java')
+            namespaceconfigs = ['': 'bom.xsd']
+            outputDir = project.file("build/generated/jaxb/schemas")
+        }
+        profile {
+            javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/profile/xml/**/*.java')
+            namespaceconfigs = ['http://www.bonitasoft.org/ns/profile/6.1': 'profiles.xsd']
+            outputDir = project.file("build/generated/jaxb/schemas")
+        }
+    }
+}
+
+processResources {
+    from "$buildDir/generated/jaxb/schemas"
+}
+
+//tasks.processResources.dependsOn tasks.jaxbSchemaGenProcessdefinition
+tasks.processResources.dependsOn tasks.jaxbSchemaGenApplication
+tasks.processResources.dependsOn tasks.jaxbSchemaGenBom
+tasks.processResources.dependsOn tasks.jaxbSchemaGenProfile
+tasks.processResources.dependsOn tasks.jaxbSchemaGenForms
\ No newline at end of file
diff --git a/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java b/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java
index eabe06c538..299123b4b0 100644
--- a/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java
+++ b/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bdm/model/field/RelationField.java
@@ -30,10 +30,12 @@ import org.bonitasoft.engine.bdm.model.BusinessObject;
 @XmlType
 public class RelationField extends Field {
 
+    @XmlType
     public enum Type {
         AGGREGATION, COMPOSITION;
     }
 
+    @XmlType
     public enum FetchType {
         EAGER, LAZY
     }
diff --git a/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java b/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java
new file mode 100644
index 0000000000..a0e1a0472f
--- /dev/null
+++ b/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/bar/form/model/package-info.java
@@ -0,0 +1,23 @@
+/**
+ * Copyright (C) 2017 Bonitasoft S.A.
+ * Bonitasoft, 32 rue Gustave Eiffel - 38000 Grenoble
+ * This library is free software; you can redistribute it and/or modify it under the terms
+ * of the GNU Lesser General Public License as published by the Free Software Foundation
+ * version 2.1 of the License.
+ * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ * See the GNU Lesser General Public License for more details.
+ * You should have received a copy of the GNU Lesser General Public License along with this
+ * program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth
+ * Floor, Boston, MA 02110-1301, USA.
+ **/
+
+/**
+ * @author Baptiste Mesta
+ */
+@XmlSchema(namespace = "http://www.bonitasoft.org/ns/form/6.0", elementFormDefault = XmlNsForm.UNSET, xmlns = {
+        @javax.xml.bind.annotation.XmlNs(namespaceURI = "http://www.bonitasoft.org/ns/form/6.0", prefix = "form") })
+package org.bonitasoft.engine.bpm.bar.form.model;
+
+import javax.xml.bind.annotation.XmlNsForm;
+import javax.xml.bind.annotation.XmlSchema;
diff --git a/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/form/package-info.java b/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/form/package-info.java
new file mode 100644
index 0000000000..fe36ddfb02
--- /dev/null
+++ b/community/bpm/bonita-common/src/main/java/org/bonitasoft/engine/bpm/form/package-info.java
@@ -0,0 +1,23 @@
+/**
+ * Copyright (C) 2017 Bonitasoft S.A.
+ * Bonitasoft, 32 rue Gustave Eiffel - 38000 Grenoble
+ * This library is free software; you can redistribute it and/or modify it under the terms
+ * of the GNU Lesser General Public License as published by the Free Software Foundation
+ * version 2.1 of the License.
+ * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ * See the GNU Lesser General Public License for more details.
+ * You should have received a copy of the GNU Lesser General Public License along with this
+ * program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth
+ * Floor, Boston, MA 02110-1301, USA.
+ **/
+
+/**
+ * @author Baptiste Mesta
+ */
+@XmlSchema(namespace = "http://www.bonitasoft.org/ns/form/6.0", elementFormDefault = XmlNsForm.UNSET, xmlns = {
+        @javax.xml.bind.annotation.XmlNs(namespaceURI = "http://www.bonitasoft.org/ns/form/6.0", prefix = "form") })
+package org.bonitasoft.engine.bpm.form;
+
+import javax.xml.bind.annotation.XmlNsForm;
+import javax.xml.bind.annotation.XmlSchema;
diff --git a/community/bpm/bonita-core/bonita-process-engine/build.gradle b/community/bpm/bonita-core/bonita-process-engine/build.gradle
index 78381ddae4..d1f9a96c59 100644
--- a/community/bpm/bonita-core/bonita-process-engine/build.gradle
+++ b/community/bpm/bonita-core/bonita-process-engine/build.gradle
@@ -1,7 +1,9 @@
-/*
- * This file was generated by the Gradle 'init' task.
- */
+plugins {
+    id 'com.intershop.gradle.jaxb' version '2.0.0'
+}
 
+group = 'org.bonitasoft.engine.core'
+description = 'Bonita Process Engine'
 dependencies {
     compile project(':bpm:bonita-core:bonita-home-server')
     compile project(':bpm:bonita-core:bonita-actor-mapping')
@@ -67,8 +69,20 @@ dependencies {
     testCompile 'com.google.guava:guava:16.0.1'
     testCompile 'com.github.stefanbirkner:system-rules:1.16.0'
     testCompile 'org.springframework:spring-test:5.1.5.RELEASE'
-    compileOnly project(':bpm:bonita-common')
+    providedCompile project(':bpm:bonita-common')
+}
+jaxb {
+    schemaGen {
+        organization {
+            javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/identity/xml/**/*.java')
+            namespaceconfigs = ['http://documentation.bonitasoft.com/organization-xml-schema/1.1': 'organization.xsd']
+            outputDir = project.file("build/generated/jaxb/schemas")
+        }
+    }
 }
 
-group = 'org.bonitasoft.engine.core'
-description = 'Bonita Process Engine'
+processResources {
+    from "$buildDir/generated/jaxb/schemas"
+}
+
+tasks.processResources.dependsOn tasks.jaxbSchemaGenOrganization
\ No newline at end of file
diff --git a/community/bpm/bonita-core/bonita-process-instance/build.gradle b/community/bpm/bonita-core/bonita-process-instance/build.gradle
index 291de66178..c5ebb0d7e0 100644
--- a/community/bpm/bonita-core/bonita-process-instance/build.gradle
+++ b/community/bpm/bonita-core/bonita-process-instance/build.gradle
@@ -1,35 +1,51 @@
-/*
- * This file was generated by the Gradle 'init' task.
- */
+plugins {
+    id 'com.intershop.gradle.jaxb' version '2.0.0'
+}
 
+group = 'org.bonitasoft.engine.core.process.instance'
+description = ''
 dependencies {
-    compile project(':bpm:bonita-common')
-    compile project(':services:bonita-recorder')
-    compile project(':bpm:bonita-core:bonita-process-definition')
-    compile project(':services:bonita-identity')
-    compile project(':services:bonita-persistence')
-    compile project(':services:bonita-commons')
-    compile project(':services:bonita-log')
-    compile project(':services:bonita-events')
-    compile project(':services:bonita-log-technical')
-    compile project(':services:bonita-archive')
-    compile project(':services:bonita-data-instance')
-    compile project(':services:bonita-classloader')
-    compile project(':bpm:bonita-core:bonita-process-comment')
-    compile project(':services:bonita-builder')
-    compile project(':bpm:bonita-core:bonita-home-server')
-    compile project(':services:bonita-session')
-    compile project(':services:bonita-dependency')
-    compile project(':services:bonita-connector-executor')
-    compile project(':services:bonita-resources')
-    compile project(':services:bonita-time-tracker')
-    compile project(':services:bonita-expression')
-    compile project(':services:bonita-cache')
-    compile project(':bpm:bonita-core:bonita-contract-data')
-    testCompile 'junit:junit:4.12'
-    testCompile 'org.assertj:assertj-core:3.7.0'
-    testCompile 'org.mockito:mockito-core:2.23.4'
+  compile project(':bpm:bonita-api:bonita-common-api')
+  compile project(':services:bonita-recorder')
+  compile project(':bpm:bonita-core:bonita-process-definition')
+  compile project(':services:bonita-identity')
+  compile project(':services:bonita-persistence')
+  compile project(':services:bonita-commons')
+  compile project(':services:bonita-log')
+  compile project(':services:bonita-events')
+  compile project(':services:bonita-log-technical')
+  compile project(':services:bonita-archive')
+  compile project(':services:bonita-data-instance')
+  compile project(':services:bonita-classloader')
+  compile project(':bpm:bonita-core:bonita-process-comment')
+  compile project(':services:bonita-builder')
+  compile project(':bpm:bonita-core:bonita-home-server')
+  compile project(':services:bonita-session')
+  compile project(':services:bonita-dependency')
+  compile project(':services:bonita-connector-executor')
+  compile project(':services:bonita-resources')
+  compile project(':services:bonita-time-tracker')
+  compile project(':services:bonita-expression')
+  compile project(':services:bonita-cache')
+    testCompile group: 'junit', name: 'junit', version:'4.12'
+    testCompile group: 'org.assertj', name: 'assertj-core', version:'3.7.0'
+    testCompile group: 'org.mockito', name: 'mockito-core', version:'2.17.0'
     compileOnly 'org.projectlombok:lombok:1.16.20'
 }
+jaxb {
+    //generates schema from java code
+    schemaGen {
+        //generates java code for project from project schema
+        connectors {
+            javaFiles = fileTree(dir: 'src/main/java', include: 'org/bonitasoft/engine/core/connector/parser/*.java')
+            namespaceconfigs = ['http://www.bonitasoft.org/ns/connector/implementation/6.0': 'connectors-impl.xsd']
+        }
+    }
+}
+
+processResources {
+    from "$buildDir/generated/jaxb/schema/connectors"
+}
+
+tasks.processResources.dependsOn tasks.jaxbSchemaGenConnectors
 
-group = 'org.bonitasoft.engine.core.process.instance'
-- 
2.20.1

