From c342fc4a4a52c83a6a8d3282f5521f356a7ed53f Mon Sep 17 00:00:00 2001
From: Emmanuel Duchastenier <emmanuel.duchastenier@bonitasoft.com>
Date: Thu, 13 Sep 2018 15:45:58 +0200
Subject: [PATCH] Fix resource filtering Gradle != Maven (banner.txt)

---
 community/platform/platform-setup/build.gradle | 18 ++++++------------
 .../src/main/resources/PLATFORM_ENGINE_VERSION |  2 +-
 .../src/main/resources/banner.txt              |  2 +-
 3 files changed, 8 insertions(+), 14 deletions(-)

diff --git a/community/platform/platform-setup/build.gradle b/community/platform/platform-setup/build.gradle
index 156a03641d..d3bfc5abc5 100644
--- a/community/platform/platform-setup/build.gradle
+++ b/community/platform/platform-setup/build.gradle
@@ -1,6 +1,5 @@
-/*
- * This file was generated by the Gradle 'init' task.
- */
+import org.apache.tools.ant.filters.ReplaceTokens
+
 apply plugin: 'distribution'
 
 
@@ -50,17 +49,12 @@ task testsJar(type: Jar) {
 
 group = 'org.bonitasoft.platform'
 publishing.publications.maven.artifact(testsJar)
-
-def generatePlatformEngineVersion = task("generatePlatformEngineVersion") {
-    doFirst{
-        project.file("build/generated/main/resources/").mkdirs()
-        project.file("build/generated/main/resources/PLATFORM_ENGINE_VERSION").text =
-                "$project.version"
+processResources {
+    from('src/main/resources') {
+        include '*'
+        filter(ReplaceTokens, tokens: [version: project.version])
     }
-    inputs.property "version", project.version
-    outputs.file project.file("build/generated/main/resources/PLATFORM_ENGINE_VERSION")
 }
-processResources.dependsOn generatePlatformEngineVersion
 
 sourceSets {
     main {
diff --git a/community/platform/platform-setup/src/main/resources/PLATFORM_ENGINE_VERSION b/community/platform/platform-setup/src/main/resources/PLATFORM_ENGINE_VERSION
index f2ab45c3b0..75c5f7d16c 100644
--- a/community/platform/platform-setup/src/main/resources/PLATFORM_ENGINE_VERSION
+++ b/community/platform/platform-setup/src/main/resources/PLATFORM_ENGINE_VERSION
@@ -1 +1 @@
-${project.version}
\ No newline at end of file
+@version@
\ No newline at end of file
diff --git a/community/platform/platform-setup/src/main/resources/banner.txt b/community/platform/platform-setup/src/main/resources/banner.txt
index a082602809..eec3c0681a 100644
--- a/community/platform/platform-setup/src/main/resources/banner.txt
+++ b/community/platform/platform-setup/src/main/resources/banner.txt
@@ -5,4 +5,4 @@
 | |_) | (_) | | | | | || (_| |
 |____/ \___/|_| |_|_|\__\__,_|
 
-(Platform Setup ${project.version})
+(Platform Setup @version@)
-- 
2.20.1

