From 8ec260262e489ab39b1c6910def060c88fcf7a87 Mon Sep 17 00:00:00 2001
From: Baptiste Mesta <baptiste.mesta@bonitasoft.com>
Date: Mon, 16 Jul 2018 10:52:23 +0200
Subject: [PATCH] fix integration tests

---
 community/platform/platform-setup/build.gradle       | 12 +++++++++---
 .../bonita-integration-ejb-api-sp/build.gradle       |  1 +
 .../bonita-integration-http-api-sp/build.gradle      |  1 +
 3 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/community/platform/platform-setup/build.gradle b/community/platform/platform-setup/build.gradle
index c282ab877e..9f45fb69c8 100644
--- a/community/platform/platform-setup/build.gradle
+++ b/community/platform/platform-setup/build.gradle
@@ -113,15 +113,21 @@ distributions {
     }
 }
 
-tasks.test.dependsOn distZip
 
 tasks.distZip.dependsOn configurations.inDistrib
 
 artifacts { distributionZip distZip }
 
 test {
+    include '**/*Test.class'
+}
+
+tasks.create("integrationTest", Test) {
+    include '**/*IT.class'
+    def testDir = new File(buildDir, "integrationTest")
     doFirst {
-        def workingDir = new File(buildDir, "tests").mkdirs()
+        testDir.mkdirs()
     }
-    workingDir workingDir
+    workingDir testDir
 }
+tasks.integrationTest.dependsOn distZip
\ No newline at end of file
diff --git a/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-ejb-api-sp/build.gradle b/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-ejb-api-sp/build.gradle
index 1cfafd1627..41473ec1cb 100644
--- a/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-ejb-api-sp/build.gradle
+++ b/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-ejb-api-sp/build.gradle
@@ -7,6 +7,7 @@ description = ''
 dependencies {
   compile project(':engine:bonita-integration-tests:bonita-integration-tests-as:bonita-integration-ejb-api')
   testCompile project(':subscription:bpm:bonita-server-sp')
+  testCompile project(':subscription:bonita-integration-tests-sp:bonita-integration-tests-client')
 }
 
 integrationTest {
diff --git a/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-http-api-sp/build.gradle b/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-http-api-sp/build.gradle
index 79bd747e06..ba90538419 100644
--- a/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-http-api-sp/build.gradle
+++ b/subscription/bonita-integration-tests-sp/bonita-integration-tests-as/bonita-integration-http-api-sp/build.gradle
@@ -10,6 +10,7 @@ dependencies {
   testCompile project(':engine:bonita-integration-tests:bonita-integration-tests-as:bonita-integration-http-api')
     testCompile group: 'org.eclipse.jetty', name: 'jetty-server', version:'9.4.9.v20180320'
     testCompile group: 'org.eclipse.jetty', name: 'jetty-servlet', version:'9.4.9.v20180320'
+  testCompile project(':subscription:bonita-integration-tests-sp:bonita-integration-tests-client')
 }
 
 integrationTest {
-- 
2.17.1

