From 8ddb57148e33fa42c1351307fd53c4998bc9da21 Mon Sep 17 00:00:00 2001
From: Baptiste Mesta <baptiste.mesta@bonitasoft.com>
Date: Wed, 25 Jul 2018 14:50:41 +0200
Subject: [PATCH] add global javadoc

---
 community/build.gradle                        | 20 -----------
 settings.gradle                               |  5 ++-
 .../bpm/bonita-global-javadoc/build.gradle    | 35 +++++++++++++++++++
 3 files changed, 39 insertions(+), 21 deletions(-)
 create mode 100644 subscription/bpm/bonita-global-javadoc/build.gradle

diff --git a/community/build.gradle b/community/build.gradle
index f748805a72..dc765da309 100644
--- a/community/build.gradle
+++ b/community/build.gradle
@@ -145,26 +145,6 @@ artifacts.archives packageSources
 }
 
 
-task allJavadoc(type: Javadoc) {
-    def candidates = [
-            ':engine:platform:platform-setup',
-            ':engine:bpm:bonita-api:bonita-common-api',
-            ':engine:bpm:bonita-api:bonita-common-api-impl',
-            ':engine:bpm:bonita-util:bonita-client-util'
-    ]
-    source candidates.collect { project(it).sourceSets.main.allJava }
-    classpath = files(candidates.collect { project(it).sourceSets.main.compileClasspath })
-    destinationDir = buildDir
-    failOnError = false
-    title = "Bonita Engine ${version} API"
-    options.links("https://docs.oracle.com/javase/8/docs/api/")
-    // TODO change it when SP is up and running:
-    options.stylesheetFile = new File("$projectDir/../subscription/bpm/bonita-global-javadoc/src/main/javadoc", "stylesheet.css")
-    options.overview = new File("$projectDir/../subscription/bpm/bonita-global-javadoc/src/main/javadoc", "overview.html")
-    options.bottom = "Copyright &copy; ${new Date().format('yyyy')} <a href=\"http://community.bonitasoft.com/\">Bonitasoft S.A.</a> All rights reserved."
-}
-
-
 publishing {
     publications {
         maven(MavenPublication) {
diff --git a/settings.gradle b/settings.gradle
index 40f217182e..a714b7bae5 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -72,4 +72,7 @@ include ':subscription'
 
 project(':subscription:bpm:bonita-common-sp').projectDir = "$rootDir/subscription/bpm/bonita-common" as File
 project(':subscription:bpm:bonita-client-sp').projectDir = "$rootDir/subscription/bpm/bonita-client" as File
-project(':subscription:bpm:bonita-server-sp').projectDir = "$rootDir/subscription/bpm/bonita-server" as File
\ No newline at end of file
+project(':subscription:bpm:bonita-server-sp').projectDir = "$rootDir/subscription/bpm/bonita-server" as File
+
+
+include ':subscription:bpm:bonita-global-javadoc'
\ No newline at end of file
diff --git a/subscription/bpm/bonita-global-javadoc/build.gradle b/subscription/bpm/bonita-global-javadoc/build.gradle
new file mode 100644
index 0000000000..889e10111a
--- /dev/null
+++ b/subscription/bpm/bonita-global-javadoc/build.gradle
@@ -0,0 +1,35 @@
+apply plugin: 'maven-publish'
+
+project.javadoc {
+    def projects = [
+            project(':engine:bpm:bonita-api:bonita-common-api'),
+            project(':engine:bpm:bonita-api:bonita-common-api-impl'),
+            project(':engine:bpm:bonita-util:bonita-client-util'),
+            project(':subscription:bpm:bonita-api-sp:bonita-common-api-sp'),
+            project(':subscription:bpm:bonita-api-sp:bonita-common-api-impl-sp'),
+            project(':subscription:bpm:bonita-util-sp:bonita-client-util-sp')
+    ]
+    source projects.collect { it.sourceSets.main.allJava }
+    classpath = project.files(projects.collect { it.sourceSets.main.compileClasspath })
+    title = "Bonita Engine ${version} API"
+    options.addStringOption('Xdoclint:none', '-quiet')
+    options.links("https://docs.oracle.com/javase/8/docs/api/")
+    // TODO change it when SP is up and running:
+    options.stylesheetFile = new File("$projectDir/src/main/javadoc", "stylesheet.css")
+    options.overview = new File("$projectDir/src/main/javadoc", "overview.html")
+    options.bottom = "Copyright &copy; ${new Date().format('yyyy')} <a href=\"http://community.bonitasoft.com/\">Bonitasoft S.A.</a> All rights reserved."
+}
+
+project.tasks.create("javadocJar", org.gradle.jvm.tasks.Jar) {
+    from javadoc
+    classifier = 'javadoc'
+}
+
+publishing{
+    publications {
+        mavenJava(MavenPublication) {
+            from project.components.java
+            artifact project.javadocJar
+        }
+    }
+}
\ No newline at end of file
-- 
2.18.0

