From fc65e28bdf87ff4530b238c1f310b69feb8a9979 Mon Sep 17 00:00:00 2001
From: Baptiste Mesta <baptiste.mesta@bonitasoft.com>
Date: Fri, 13 Jul 2018 16:14:32 +0200
Subject: [PATCH] bdm access controle jaxb

---
 .../bonita-common-util-sp/build.gradle        | 61 +++++++++++++++++++
 1 file changed, 61 insertions(+)

diff --git a/subscription/bpm/bonita-util-sp/bonita-common-util-sp/build.gradle b/subscription/bpm/bonita-util-sp/bonita-common-util-sp/build.gradle
index 820a7a1a9e..073ceb7297 100644
--- a/subscription/bpm/bonita-util-sp/bonita-common-util-sp/build.gradle
+++ b/subscription/bpm/bonita-util-sp/bonita-common-util-sp/build.gradle
@@ -1,3 +1,11 @@
+//plugins {
+//    id 'com.intershop.gradle.jaxb' version '2.0.0'
+//}
+
+configurations {
+    jaxb2
+}
+
 group = 'com.bonitasoft.engine.util'
 description = ''
 dependencies {
@@ -10,6 +18,11 @@ dependencies {
     testCompile group: 'org.mockito', name: 'mockito-core', version:'2.17.0'
     testCompile group: 'org.slf4j', name: 'slf4j-simple', version:'1.7.25'
   compileOnly project(':engine:bpm:bonita-util:bonita-common-util')
+    jaxb2 'com.sun.xml.bind:jaxb-core:2.2.11'
+    jaxb2 'com.sun.xml.bind:jaxb-xjc:2.2.11'
+    jaxb2 'com.sun.xml.bind:jaxb-impl:2.2.11'
+    jaxb2 'javax.xml.bind:jaxb-api:2.2.11'
+    jaxb2 'org.glassfish.jaxb:jaxb-jxc:2.2.11'
 }
 
 task packageTests(type: Jar) {
@@ -17,3 +30,51 @@ task packageTests(type: Jar) {
   classifier = 'tests'
 }
 artifacts.archives packageTests
+
+
+
+
+task('schemagen') {
+    def destDir = file("$buildDir/generated/jaxb/schema/accesscontrol")
+    doLast {
+        try {
+            destDir.mkdirs()
+            ant.taskdef(name: 'schemagen', classname: 'com.sun.tools.jxc.SchemaGenTask', classpath: configurations.jaxb2.asPath)
+            ant.schemagen(srcdir: new File('src/main/java/'), destdir: destDir, includeAntRuntime: 'false') {
+                include(name: 'com/bonitasoft/engine/bdm/accesscontrol/model/')
+            }
+        } catch (Exception e) {
+            def schema = file("$destDir/schema1.xsd")
+            if (!schema.exists()) {
+                throw new GradleException("schema not generated", e)
+            }
+            schema.renameTo(file("$destDir/bdm-access-control.xsd"))
+        }
+    }
+    inputs.dir('src/main/java/')
+    outputs.file("$destDir/bdm-access-control.xsd")
+}
+
+
+processResources {
+    from "$buildDir/generated/jaxb/schema/accesscontrol"
+}
+
+tasks.processResources.dependsOn tasks.schemagen
+
+//Not working :(
+//jaxb {
+//    schemaGen {
+//        accesscontrol {
+//            javaFiles = fileTree(dir: 'src/main/java', include: 'com/bonitasoft/engine/bdm/accesscontrol/model/*.java')
+//            namespaceconfigs = ['http://documentation.bonitasoft.com/bdm-access-control-xml-schema/1.0': 'bdm-access-control.xsd']
+//            outputDir = project.file("build/generated/jaxb/schemas")
+//        }
+//    }
+//}
+//
+//processResources {
+//    from "$buildDir/generated/jaxb/schemas"
+//}
+//
+//tasks.processResources.dependsOn tasks.jaxbSchemaGenAccesscontrol
-- 
2.17.1

