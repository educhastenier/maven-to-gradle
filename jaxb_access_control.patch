From a48e8f56decd8ec801f3b137a31065ec70ee8f5a Mon Sep 17 00:00:00 2001
From: Baptiste Mesta <baptiste.mesta@bonitasoft.com>
Date: Fri, 13 Jul 2018 16:14:32 +0200
Subject: [PATCH] bdm access controle jaxb

---
 subscription/bpm/bonita-common/build.gradle | 57 +++++++++++++++++++++
 1 file changed, 57 insertions(+)

diff --git a/subscription/bpm/bonita-common/build.gradle b/subscription/bpm/bonita-common/build.gradle
index bb15620d3c..ec022c3afc 100644
--- a/subscription/bpm/bonita-common/build.gradle
+++ b/subscription/bpm/bonita-common/build.gradle
@@ -1,7 +1,13 @@
 /*
  * This file was generated by the Gradle 'init' task.
  */
+//plugins {
+//    id 'com.intershop.gradle.jaxb' version '2.0.0'
+//}
 
+configurations {
+    jaxb2
+}
 dependencies {
     compile project(':engine:bpm:bonita-common')
     compile 'org.apache.commons:commons-lang3:3.3.2'
@@ -16,6 +22,11 @@ dependencies {
     testCompile 'org.jmockit:jmockit:1.44'
     compileOnly 'com.sap:sapjco:3.0.3'
     testCompile group: 'com.sap', name: 'sapjco', version:'3.0.3'
+    jaxb2 'com.sun.xml.bind:jaxb-core:2.2.11'
+    jaxb2 'com.sun.xml.bind:jaxb-xjc:2.2.11'
+    jaxb2 'com.sun.xml.bind:jaxb-impl:2.2.11'
+    jaxb2 'javax.xml.bind:jaxb-api:2.2.11'
+    jaxb2 'org.glassfish.jaxb:jaxb-jxc:2.2.11'
 }
 
 task testsJar(type: Jar) {
@@ -26,3 +37,49 @@ task testsJar(type: Jar) {
 group = 'com.bonitasoft.engine'
 description = 'Bonita Common SP'
 publishing.publications.maven.artifact(testsJar)
+
+
+task('schemagen') {
+    def destDir = file("$buildDir/generated/jaxb/schema/accesscontrol")
+    doLast {
+        try {
+            destDir.mkdirs()
+            ant.taskdef(name: 'schemagen', classname: 'com.sun.tools.jxc.SchemaGenTask', classpath: configurations.jaxb2.asPath)
+            ant.schemagen(srcdir: new File('src/main/java/'), destdir: destDir, includeAntRuntime: 'false') {
+                include(name: 'com/bonitasoft/engine/bdm/accesscontrol/model/')
+            }
+        } catch (Exception e) {
+            def schema = file("$destDir/schema1.xsd")
+            if (!schema.exists()) {
+                throw new GradleException("schema not generated", e)
+            }
+            schema.renameTo(file("$destDir/bdm-access-control.xsd"))
+        }
+    }
+    inputs.dir('src/main/java/')
+    outputs.file("$destDir/bdm-access-control.xsd")
+}
+
+
+processResources {
+    from "$buildDir/generated/jaxb/schema/accesscontrol"
+}
+
+tasks.processResources.dependsOn tasks.schemagen
+
+//Not working :(
+//jaxb {
+//    schemaGen {
+//        accesscontrol {
+//            javaFiles = fileTree(dir: 'src/main/java', include: 'com/bonitasoft/engine/bdm/accesscontrol/model/*.java')
+//            namespaceconfigs = ['http://documentation.bonitasoft.com/bdm-access-control-xml-schema/1.0': 'bdm-access-control.xsd']
+//            outputDir = project.file("build/generated/jaxb/schemas")
+//        }
+//    }
+//}
+//
+//processResources {
+//    from "$buildDir/generated/jaxb/schemas"
+//}
+//
+//tasks.processResources.dependsOn tasks.jaxbSchemaGenAccesscontrol
-- 
2.20.1

